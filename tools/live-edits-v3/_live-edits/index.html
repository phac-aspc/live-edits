<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
<head>
    <!-- Fill metadata before launch and edit title at line 32-->
    <meta content="width=device-width,initial-scale=1" name="viewport" charset="utf-8">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Public Health Agency of Canada">
    <meta name="dcterms.title" content="... ‚Äî Canada.ca">
    <meta name="dcterms.description" content="">
    <meta name="dcterms.creator" content="Public Health Agency of Canada">
    <meta name="dcterms.language" title="ISO639-2/T" content="eng">
    <meta name="dcterms.issued" title="W3CDTF" content="2024-01-16">
    <meta name="dcterms.modified" title="W3CDTF" content="2024-01-16">
    <meta name="dcterms.spatial" content="Canada">
    <meta name="dcterms.type" content="datasets;statistics;education and awareness">
    <meta name="dcterms.identifier" content="Public_Health_Agency_of_Canada">
    <link href="/src/GCWeb/assets/favicon.ico" rel="icon" type="image/x-icon">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" integrity="sha384-REHJTs1r2ErKBuJB0fCK99gCYsVjwxHrSU0N7I1zl9vZbggVJXRMsv/sLlOAGb4M" crossorigin="anonymous">
    <link rel="stylesheet" href="/src/GCWeb2/css/theme.min.css">
    <link rel="stylesheet" href="/src/css/global.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- Link to your custom css stylesheet, edit path below -->

    <noscript>
        <link rel="stylesheet" href="/src/wet-boew/css/noscript.min.css" />
    </noscript>
    
    <title>Live Edits Dashboard ‚Äî Canada.ca</title>
  
  <style>
    /* Custom styles for dashboard */
    .dashboard-section {
      margin: 40px 0;
    }
    
    .product-card, .template-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 20px;
      transition: box-shadow 0.2s;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    
    .product-card:hover, .template-card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-decoration: none;
      color: inherit;
    }
    
    .product-card h3, .template-card h3 {
      margin-top: 0;
      color: #26374a;
    }
    
    .badge {
      display: inline-block;
      background: #335075;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.8em;
      margin-top: 10px;
    }
    
    .template-badge {
      background: #2e8540;
    }
    
    .timestamp {
      font-size: 0.85em;
      color: #666;
      margin-top: 8px;
    }
    
    .template-icon {
      font-size: 2.5em;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .loading, .error, .empty-state {
      text-align: center;
      padding: 40px;
    }
    
    .empty-state-icon {
      font-size: 4em;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .btn-template {
      background: #2e8540;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      margin-top: 10px;
      width: 100%;
      transition: background 0.2s;
    }
    
    .btn-template:hover {
      background: #1f5d2e;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 4px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-content input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1em;
      margin-bottom: 20px;
    }
    
    .modal-content input:focus {
      outline: none;
      border-color: #335075;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      margin-left: 10px;
    }
    
    .btn-primary {
      background: #335075;
      color: white;
    }
    
    .btn-primary:hover {
      background: #26374a;
    }
    
    .btn-secondary {
      background: #666;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #555;
    }
  </style>
</head>
<body vocab="http://schema.org/" typeof="WebPage">
    <!-- Google Tag Manager DO NOT REMOVE OR MODIFY - NE PAS SUPPRIMER OU MODIFIER -->
    <script>
        dataLayer1 = [];
    </script>
    <script>
        dataLayer = [];
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google Tag Manager -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TN3RPZ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-TN3RPZ');
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google Tag Manager DO NOT REMOVE OR MODIFY - NE PAS SUPPRIMER OU MODIFIER -->
    <noscript><iframe title="Google Tag Manager" src="https://www.googletagmanager.com/ns.html?id=GTM-TLGQ9K" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer1' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer1', 'GTM-TLGQ9K');
    </script>
    <!-- End Google Tag Manager -->

    <ul id="wb-tphp">
        <li class="wb-slc">
            <a class="wb-sl" href="#wb-cont">Skip to main content</a>
        </li>
        <li class="wb-slc">
            <a class="wb-sl" href="#wb-info">Skip to "About government"</a>
        </li>
    </ul>
    <header class="navbar navbar-default" id="navbar" style="background-color: white !important; margin-bottom: 0px;">
        <div id="wb-bnr" class="container">
            <section id="wb-lng" class="text-right">
                <h2 class="wb-inv">Language selection</h2>
                <ul class="list-inline margin-bottom-none">
                    <li><a lang="fr" href="theme-templates/index-fr.html" id="otherLangAnchor">Fran√ßais</a></li>
                </ul>
            </section>
            <div class="row">
                <div class="brand col-xs-5 col-md-4">
                    <a href="https://www.canada.ca/en.html"><img src="/src/GCWeb/assets/sig-blk-en.svg" alt=""><span class="wb-inv"> Government of Canada / <span lang="fr">Gouvernement du Canada</span></span></a>
                </div>
                <section id="wb-srch" class="col-lg-8 text-right">
                    <h2>Search</h2>
                    <form action="https://www.canada.ca/en/sr/srb.html" method="get" name="cse-search-box" role="search" class="form-inline">
                        <div class="form-group">
                            <label for="wb-srch-q" class="wb-inv">Search Canada.ca</label>
                            <input id="wb-srch-q" list="wb-srch-q-ac" class="wb-srch-q form-control" name="q" type="search" value="" size="34" maxlength="170" placeholder="Search Canada.ca">
                            <datalist id="wb-srch-q-ac">
                            </datalist>
                        </div>
                        <div class="form-group submit">
                            <button type="submit" id="wb-srch-sub" class="btn btn-primary btn-small" name="wb-srch-sub"><span class="glyphicon-search glyphicon"></span><span class="wb-inv">Search</span></button>
                        </div>
                    </form>
                </section>
            </div>
        </div>
        <nav id="wb-bc" property="breadcrumb" aria-labelledby="breadcrumbTitle">
            <h2 id="breadcrumbTitle">You are here:</h2>
            <div class="container">
                <ol class="breadcrumb">
                    <li><a href="https://www.canada.ca/en.html">Canada.ca</a></li>
                    <li><a href="https://www.canada.ca/en/services/health.html">Health</a></li>
                    <li><a href="https://www.canada.ca/en/services/health/science-research-data.html">Health science, research and data</a></li>
                    <li><a href="https://health-infobase.canada.ca">Health Infobase</a></li>
                </ol>
            </div>
        </nav>
    </header>

  <main property="mainContentOfPage" id="main">
    <section class="blue-header well well-sm brdr-0 mrgn-bttm-0 mrgn-tp-0">
        <div class="container mrgn-tp-sm">
            <h1 class="mrgn-tp-md" property="name" id="wb-cont" dir="ltr"><span class="stacked"><span>Live Edits Dashboard</span>: <span></span></span></h1>
            <p>Manage and create products for live editing.</p>
            <ul class="list-inline small mrgn-bttm-sm" style="line-height:1.65em" id="list-inline-desktop-only">
                <li class="mrgn-rght-lg"> Last updated: 2024-01-16</li>
                <!--<li> <a class="pdf" href="/covid-19/post-covid-condition/COVID-19-longer-term-symptoms-among-Canadian-adults.pdf"><i class="fa fa-download" aria-hidden="true"></i> <span class="wb-invisible">Download page in </span>PDF<span class="wb-invisible"> format</span></a></li>-->
                <!--<li> <a class="pdf" href="#"><i class="fa fa-download" aria-hidden="true"></i> <span class="wb-invisible">Download data in </span>CSV<span class="wb-invisible"> format</span></a></li>-->
            </ul>
        </div>
    </section>

    <section class="well well-sm brdr-0 mrgn-bttm-25 mrgn-tp-0 tabNav" style="padding:0px;">
        <div class="container">
            <nav>
                <!--<ul class="list-inline hidden-xs hidden-sm mrgn-bttm-0">-->
                <!--    <li><a class="active btn btn-tabs" id="active-tab0" role="button" href="#">Tab 1</a></li>-->
                <!--    <li><a class="btn btn-tabs" id="tab1" role="button" href=".html">Tab 2</a></li>-->
                <!--    <li><a class="btn btn-tabs" id="tab2" role="button" href=".html">Tab 3</a></li>-->
                <!--    <li><a class="btn btn-tabs" id="tab3" role="button" href=".html">Tab 4</a></li>-->
                <!--    <li><a class="btn btn-tabs" id="tab4" role="button" href=".html">Tab 5</a></li>-->
                <!--</ul>-->

                <!--<ul class="list-unstyled hidden-md hidden-lg">-->
                <!--    <li><a class="active btn btn-tabs-mobile" style="padding:10px 0px;" id="active-tab0" role="button" href="#">Tab 1</a></li>-->
                <!--    <li><a class="btn btn-tabs-mobile" id="tab1" role="button" href=".html">Tab 2</a></li>-->
                <!--    <li><a class="btn btn-tabs-mobile" id="tab2" role="button" href=".html">Tab 3</a></li>-->
                <!--    <li><a class="btn btn-tabs-mobile" id="tab3" role="button" href=".html">Tab 4</a></li>-->
                <!--    <li><a class="btn btn-tabs-mobile" id="tab4" role="button" href=".html">Tab 5</a></li>-->
                <!--</ul>-->
            </nav>
        </div>
    </section>


    <div class="container">

    <!-- Current Editable Products Section -->
      <section class="dashboard-section">
        <h2>Current editable products</h2>
        <div id="products-container">
          <div class="loading">Loading products...</div>
        </div>
      </section>
  
      <!-- Product Templates Section -->
      <!-- <section class="dashboard-section">
        <h2>Product templates</h2>
        <div class="row" id="templates-container">
          <div class="col-md-4">
            <div class="template-card" data-template="data-blog">
              <div class="template-icon">üìä</div>
              <h3>Data Blog</h3>
              <p>Template for creating data blog pages with key findings, statistics, and visualizations.</p>
              <span class="badge template-badge">Template</span>
              <button class="btn-template" onclick="openTemplate('data-blog')">Use Template</button>
            </div>
          </div>
        </div>
      </section> -->
    </div>
  </main>

  <!-- Modal for saving template as new product -->
  <div id="saveModal" class="modal">
    <div class="modal-content">
      <h3>Save Template as New Product</h3>
      <input type="text" id="productNameInput" placeholder="Enter product name (e.g., my-data-blog)" />
      <div style="text-align: right;">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveTemplateAsProduct()">Save</button>
      </div>
    </div>
  </div>

    <footer id="wb-info">
        <h2 class="wb-inv">About this site</h2>
        <div class="gc-contextual">
            <div class="container">
                <nav>
                    <h3><a href="https://health-infobase.canada.ca">Health Infobase</a></h3>
                    <ul class="list-col-xs-1 list-col-sm-2 list-col-md-3">
                        <li><a href="mailto:infobase@phac-aspc.gc.ca">Contact us by email</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="gc-main-footer">
            <div class="container">
                <nav>
                    <h3>Government of Canada</h3>
                    <ul class="list-col-xs-1 list-col-sm-2 list-col-md-3">
                        <li><a href="https://www.canada.ca/en/contact.html">All Contacts</a></li>
                        <li><a href="https://www.canada.ca/en/government/dept.html">Departments and agencies</a></li>
                        <li><a href="https://www.canada.ca/en/government/system.html">About government</a></li>
                    </ul>
                    <h4><span class="wb-inv">Themes and topics</span></h4>
                    <ul class="list-unstyled colcount-sm-2 colcount-md-3">
                        <li><a href="https://www.canada.ca/en/services/jobs.html">Jobs</a></li>
                        <li><a href="https://www.canada.ca/en/services/immigration-citizenship.html">Immigration and citizenship</a></li>
                        <li><a href="https://travel.gc.ca/">Travel and tourism</a></li>
                        <li><a href="https://www.canada.ca/en/services/business.html">Business</a></li>
                        <li><a href="https://www.canada.ca/en/services/benefits.html">Benefits</a></li>
                        <li><a href="https://www.canada.ca/en/services/health.html">Health</a></li>
                        <li><a href="https://www.canada.ca/en/services/taxes.html">Taxes</a></li>
                        <li><a href="https://www.canada.ca/en/services/environment.html">Environment and natural resources</a></li>
                        <li><a href="https://www.canada.ca/en/services/defence.html">National security and defence</a></li>
                        <li><a href="https://www.canada.ca/en/services/culture.html">Culture, history and sport</a></li>
                        <li><a href="https://www.canada.ca/en/services/policing.html">Policing, justice and emergencies</a></li>
                        <li><a href="https://www.canada.ca/en/services/transport.html">Transport and infrastructure</a></li>
                        <li><a href="https://international.gc.ca/world-monde/index.aspx?lang=eng">Canada and the world</a></li>
                        <li><a href="https://www.canada.ca/en/services/finance.html">Money and finance</a></li>
                        <li><a href="https://www.canada.ca/en/services/science.html">Science and innovation</a></li>
                        <li><a href="https://www.canada.ca/en/services/indigenous-peoples.html">Indigenous peoples</a></li>
                        <li><a href="https://www.canada.ca/en/services/veterans.html">Veterans and military</a></li>
                        <li><a href="https://www.canada.ca/en/services/youth.html">Youth</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="gc-sub-footer">
            <div class="container d-flex align-items-center">
                <nav>
                    <h3 class="wb-inv">Government of Canada Corporate</h3>
                    <ul>
                        <li><a href="https://www.canada.ca/en/social.html">Social media</a></li>
                        <li><a href="https://www.canada.ca/en/mobile.html">Mobile applications</a></li>
                        <li><a href="https://www.canada.ca/en/government/about.html">About Canada.ca</a></li>
                        <li><a href="https://www.canada.ca/en/transparency/terms.html">Terms and conditions</a></li>
                        <li><a href="https://www.canada.ca/en/transparency/privacy.html">Privacy</a></li>
                    </ul>
                </nav>
                <div class="wtrmrk align-self-end">
                    <img src="/src/assets/wmms-blk.svg" alt="Symbol of the Government of Canada" />
                </div>
            </div>
        </div>
    </footer>
    <script src="/src/js/jquery.js"></script>
    <script src="/src/wet-boew/js/wet-boew.min.js"></script>
    <script src="/src/GCWeb/js/theme.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="/src/js/datatables.js"></script>
    <script src="/src/js/d3.v7.min.js"></script>
    <script src="/src/js/d3-interpolate-path/d3-interpolate-path.min.js"></script>
    <script src="/src/js/topojson.v2.min.js"></script>
    <script src="/src/js/polylabel.js"></script>
    <script src="/src/js/d3-array.v2.min.js"></script>
    <script src="/src/js/survey.js"></script>
    <script src="/src/js/functions/localization.js"></script>
    <script>
        var beforePrint = function() {
            $("details").attr('open', '');
        };

        var afterPrint = function() {
            $("details").removeAttr('open');
        };

        if (window.matchMedia) {
            var mediaQueryList = window.matchMedia('print');
            mediaQueryList.addListener(function(mql) {
                if (mql.matches) {
                    beforePrint();
                }
                else {
                    afterPrint();
                }
            });
        }

        $(document).on("wb-ready.wb", function() {
            $("#btnno").click(function(e) {
                $(".gc-pg-hlpfl-no").removeClass("nojs-show");
                $(".gc-pg-hlpfl-btn").addClass("hide");
                $("#helpful").val("No");
            });
            $("#gc-pg-hlpfl-frm").submit(function(e) {
                e.preventDefault();
                $(".gc-pg-hlpfl-thnk").removeClass("hide");
                $("#gc-pg-hlpfl-frm").addClass("hide nojs-show");
                $.ajax({
                    url: 'https://pagesuccessemailqueue.azurewebsites.net/api/QueueProblemForm',
                    type: 'POST',
                    dataType: 'text',
                    data: $('form#gc-pg-hlpfl-frm').serialize(),
                    success: function(data) {},
                    error: function(xhr, status, err) {
                        console.log(xhr.responseText);
                    }
                });
            });
        });
    </script>

  <script>
    const SERVER_URL = "https://en.infobase-dev.com" + '/live-edits';
    let currentTemplate = null;

    // Fetch and display products
    async function loadProducts() {
      const container = document.getElementById('products-container');
      
      try {
        const response = await fetch(`${SERVER_URL}/projects`);
        if (!response.ok) throw new Error('Failed to fetch products');
        
        const allProjects = await response.json();
        
        // Filter to only include products in the /products subfolder, excluding templates folder
        const projects = allProjects.filter(project => {
          const folderPath = project.folder_path || '';
          // Include only products in /products subfolder, but exclude templates folder
          return folderPath.startsWith('/_live-edits/products/') && 
                 !folderPath.startsWith('/_live-edits/products/templates');
        });
        
        if (projects.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üìÅ</div>
              <p>No products found. Create a new product from a template to get started.</p>
            </div>
          `;
          return;
        }

        // Fetch latest edit timestamps for each project
        const productsWithTimestamps = await Promise.all(
          projects.map(async (project) => {
            try {
              const editsResponse = await fetch(`${SERVER_URL}/edits/project/${project.id}`);
              if (editsResponse.ok) {
                const edits = await editsResponse.json();
                const latestEdit = edits.length > 0 
                  ? edits.reduce((latest, edit) => 
                      edit.created_at > latest.created_at ? edit : latest
                    )
                  : null;
                return { ...project, latestEdit };
              }
            } catch (e) {
              console.error('Error fetching edits for project:', project.id, e);
            }
            return { ...project, latestEdit: null };
          })
        );

        // Sort by latest edit timestamp (most recent first)
        productsWithTimestamps.sort((a, b) => {
          if (!a.latestEdit && !b.latestEdit) return 0;
          if (!a.latestEdit) return 1;
          if (!b.latestEdit) return -1;
          return b.latestEdit.created_at - a.latestEdit.created_at;
        });

        container.innerHTML = `
          <div class="row">
            ${productsWithTimestamps.map(project => {
              // Use default_page from database if available, otherwise default to /index.html
              const defaultPage = project.default_page || '/index.html';
              const productUrl = project.folder_path + defaultPage;
              const hasEdits = project.latestEdit !== null;
              const timestamp = project.latestEdit 
                ? formatTimestamp(project.latestEdit.created_at)
                : 'No edits yet';
              
              return `
                <div class="col-md-4">
                  <a href="${productUrl}" class="product-card">
                    <h3>${escapeHtml(project.name)}</h3>
                    <div>
                      <div>Path: <code>${escapeHtml(project.folder_path)}</code></div>
                      <div class="timestamp">Last edited: ${timestamp}</div>
                      ${hasEdits ? '<span class="badge">Has edits</span>' : ''}
                    </div>
                  </a>
                </div>
              `;
            }).join('')}
          </div>
        `;
      } catch (error) {
        console.error('Error loading products:', error);
        container.innerHTML = `
          <div class="error">
            <strong>Error loading products:</strong> ${escapeHtml(error.message)}
            <br><br>
            Make sure the server is running and accessible at: ${SERVER_URL}
          </div>
        `;
      }
    }

    function formatTimestamp(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
      if (diffHours < 24) return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
      if (diffDays < 7) return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
      
      return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Template functions
    function openTemplate(templateName) {
      const templateUrl = `/_live-edits/templates/${templateName}/index.html`;
      
      // Open template in new tab (editable - user can edit and save as new product)
      window.open(templateUrl, '_blank');
    }

    function closeModal() {
      document.getElementById('saveModal').classList.remove('show');
      currentTemplate = null;
      document.getElementById('productNameInput').value = '';
    }

    async function saveTemplateAsProduct() {
      const productName = document.getElementById('productNameInput').value.trim();
      
      if (!productName) {
        alert('Please enter a product name');
        return;
      }

      // Validate product name (alphanumeric, dashes, underscores only)
      if (!/^[a-zA-Z0-9_-]+$/.test(productName)) {
        alert('Product name can only contain letters, numbers, dashes, and underscores');
        return;
      }

      closeModal();

      // Show loading message
      const loadingMsg = document.createElement('div');
      loadingMsg.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 2000; text-align: center;';
      loadingMsg.innerHTML = `
        <p>Creating product from template...</p>
        <p style="font-size: 0.9em; color: #666; margin-top: 10px;">Please run this command on the server:</p>
        <code style="display: block; background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; font-size: 0.9em;">
          node scripts/copy-template.js ${currentTemplate} ${productName}
        </code>
        <p style="font-size: 0.9em; color: #666;">Or click the link below to try accessing the product (if it was already created):</p>
        <button class="btn btn-primary" onclick="window.location.href='/_live-edits/products/${productName}/index.html'; this.parentElement.remove();" style="margin-top: 10px;">
          Open Product
        </button>
        <button class="btn btn-secondary" onclick="this.parentElement.remove();" style="margin-top: 10px; margin-left: 10px;">
          Close
        </button>
      `;
      document.body.appendChild(loadingMsg);

      // Try to call API endpoint if available (for future server-side implementation)
      try {
        const response = await fetch(`/_live-edits/api/copy-template`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            template: currentTemplate,
            productName: productName
          })
        });

        if (response.ok) {
          const result = await response.json();
          loadingMsg.remove();
          // Redirect to the new product
          window.location.href = `/_live-edits/products/${productName}/index.html`;
          return;
        }
      } catch (error) {
        // API endpoint not available, show instructions
        console.log('API endpoint not available, showing manual instructions');
      }
    }

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // Close modal on background click
    document.getElementById('saveModal').addEventListener('click', (e) => {
      if (e.target.id === 'saveModal') {
        closeModal();
      }
    });

    // Load products on page load
    loadProducts();
  </script>
</body>
</html>
